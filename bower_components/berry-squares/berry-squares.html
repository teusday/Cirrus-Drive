<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../neon-animation/neon-shared-element-animatable-behavior.html">
<link rel="import" href="../neon-animation/neon-animatable-behavior.html">
<link rel="import" href="../neon-animation/neon-animation-runner-behavior.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-icon-button/paper-icon-button.html">
<dom-module id="berry-squares">
    <style>
    .flex-horizontal {
        @apply(--layout-horizontal);
    }
    
    .flexchild {
        @apply(--layout-flex);
    }
    
    #squareHeader {
        position: relative;
        left: -8px;
        width: 101.5%;
        top: -180px;
        height: 200px;
        background-color: var(--primary-color);
        color: white;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
        font-size: 25pt;
    }
    
    #backButton {
        position: absolute;
        left: 10px;
        top: 10px;
        color: #FFFFFF;
    }
    
    #squareContent {
        height: 100%;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
    }
    
    .square {
        width: 150px;
        height: 150px;
        margin: 50px;
        background: var(--accent-color);
        color: #FFFFFF;
        padding: 30px;
        @apply(--layout-vertical);
        @apply(--layout-center-center);
    }
    
    #messagesContent {
        position: absolute;
        left: 0px;
        right: 0px;
        top: 90px;
        @apply(--layout-horizontal);
        @apply(--layout-center-center);
    }
    
    #messagesPinkContainer {
        color: white;
        background-color: var(--accent-color);
        max-width: 800px;
        width: 100%;
        height: 100%;
        margin: 10px;
    }
    
    #messagesPinkContainer paper-listbox {
        margin: 10px;
    }
    
    div[secondary] {
        font-size: 10pt;
        color: gray;
    }
    </style>
    <template>
        <div id="squareHeader">
            <paper-icon-button id="backButton" icon="arrow-back" on-click="_backClick"></paper-icon-button>
            <template is="dom-if" if="[[_compareID(pageId, 'project')]]">
                <h1 id="squareTitle">Projects</h1>
            </template>
            <template is="dom-if" if="[[_compareID(pageId, 'message')]]">
                <h1 id="squareTitle">Messages</h1>
            </template>
            <template is="dom-if" if="[[_compareID(pageId, 'task')]]">
                <h1 id="squareTitle">Tasks</h1>
            </template>
        </div>
        <template is="dom-if" if="[[_compareID(pageId, 'project')]]">
            <div id="squareContent">
                <div class="square squareAnimate" id="openProjectsSquare" on-click="_openProjectSquareClick">
                    <iron-icon icon="assignment"></iron-icon>
                    <br>Open Projects
                </div>
                <div class="square squareAnimate" id="closedProjectsSquare" on-click="_closedProjectSquareClick">
                    <iron-icon icon="assignment-turned-in"></iron-icon>
                    <br>Closed Projects
                </div>
            </div>
        </template>
        <template is="dom-if" if="[[_compareID(pageId, 'message')]]">
            <firebase-collection id="getOpenProjects" location="https://cirrus-drive.firebaseio.com/messages/berrste/inbox" data="{{messageData}}"></firebase-collection>
            <div id="messagesContent">
                <div id="messagesPinkContainer" class="squareAnimate">
                    <paper-listbox id="messagesList">
                        <template is="dom-repeat" items="[[messageData]]" as="message">
                            <!-- don't forget to sort it by date and time -->
                            <paper-item role="menuitem" class="flex-horizontal" on-click="_messageClick">
                                <paper-item-body two-line class="flexchild">
                                    <div>[[message.subject]]</div>
                                    <div secondary>[[message.value]]</div>
                                </paper-item-body>
                                <paper-icon-button icon="info"></paper-icon-button>
                            </paper-item>
                        </template>
                    </paper-listbox>
                </div>
            </div>
            <paper-dialog id="messageInfoDialog" entry-animation="scale-up-animation" exit-animation="fade-out-animation" with-backdrop>
                <h2>[[clickedMessage.subject]]</h2>
                <p>[[clickedMessage.value]]</p>
            </paper-dialog>
        </template>
        <template is="dom-if" if="[[_compareID(pageId, 'task')]]">
        </template>
    </template>
</dom-module>
<script>
Polymer({
    is: "berry-squares",
    behaviors: [
        Polymer.NeonSharedElementAnimatableBehavior
    ],
    properties: {
        squaresArray: {
            type: Array
        },
        clickedMessage: {
            type: Object
        },
        sharedElements: {
            value: function() {
                return {
                    'hero': this.$.squareHeader,
                    'projectHero': this.$.openProjectsSquare
                }
            }
        },
        animationConfig: {
            type: Object,
            value: function() {
                return {
                    'entry': [{
                        name: 'hero-animation',
                        id: 'hero',
                        toPage: this
                    }, {
                        name: 'cascaded-animation',
                        animation: 'transform-animation',
                        transformFrom: 'translateY(100vh)'
                    }],
                    'exit': [{
                        name: 'cascaded-animation',
                        animation: 'transform-animation',
                        transformTo: 'translateY(100vh)'
                    }, {
                        name: 'transform-animation',
                        transformTo: 'translateY(-30vh)',
                        node: this.$.squareHeader
                    }]
                }
            }
        },
        pageId: {
            type: String,
            value: "project"
        },
        messageData: {
            type: Array
        }
    },
    _compareID: function(a, b) {
        if (a == b) {
            return true;
        } else {
            return false;
        }
    },
    _backClick: function() {
        this.animationConfig['exit'] = [{
            name: 'cascaded-animation',
            animation: 'transform-animation',
            transformTo: 'translateY(100vh)'
        }, {
            name: 'transform-animation',
            transformTo: 'translateY(-30vh)',
            node: this.$.squareHeader
        }];
        this.fire("back-click");
    },
    _openProjectSquareClick: function() {
        this.animationConfig['exit'][0] = {
            name: 'scale-down-animation',
            node: document.getElementById('closedProjectsSquare')
        };
        this.animationConfig['exit'].push({
            name: 'hero-animation',
            id: 'projectHero',
            fromPage: this
        });
        this.sharedElements['projectHero'] = document.getElementById('openProjectsSquare');
        this.fire("open-projects-click");
    },
    _closedProjectSquareClick: function() {
        this.animationConfig['exit'][0] = {
            name: 'scale-down-animation',
            node: document.getElementById('openProjectsSquare')
        };
        this.animationConfig['exit'].push({
            name: 'hero-animation',
            id: 'projectHero',
            fromPage: this
        });
        this.sharedElements['projectHero'] = document.getElementById('closedProjectsSquare');
        this.fire("closed-projects-click");
    },
    _messageClick: function(e) {
        this.clickedMessage = e.model.__data__.message;
        this.$.messageInfoDialog.open();
    }
});
</script>